function onLoaded(){this.bg=new Background,Laya.stage.addChild(this.bg),this.roleBox=new Laya.Sprite,Laya.stage.addChild(this.roleBox),this.gameInfo=new GameInfo,Laya.stage.addChild(this.gameInfo),this.hero=new Role,this.roleBox.addChild(this.hero),restart()}function onLoading(e){this.progress.update(e),1===e&&onLoaded()}function onLoop(){for(t=this.roleBox.numChildren-1;t>-1;t--){var e=this.roleBox.getChildAt(t);if(e&&e.speed&&(e.y+=e.speed,(e.y>1e3||!e.visible||e.isBullet&&e.y<-20)&&(e.removeSelf(),e.isBullet=!1,e.visible=!0,Laya.Pool.recover("role",e))),e.shootType>0){var a=Laya.Browser.now();if(a>e.shootTime){e.shootTime=a+e.shootInterval;for(var o=this.bulletPos[e.shootType-1],t=0;t<o.length;t++){var s=Laya.Pool.getItemByClass("role",Role);s.init("bullet1",e.camp,1,-4-e.shootType-Math.floor(this.level/15),1,1),s.pos(e.x+o[t],e.y-e.hitRadius-10),this.roleBox.addChild(s)}Laya.SoundManager.playSound("res/sound/bullet.mp3")}}}for(t=this.roleBox.numChildren-1;t>-1;t--){var r=this.roleBox.getChildAt(t);if(!(r.hp<1))for(var i=t-1;i>-1;i--)if(r.visible){var l=this.roleBox.getChildAt(i);if(l.hp>0&&r.camp!==l.camp){var h=r.hitRadius=l.hitRadius;Math.abs(r.x-l.x)<h&&Math.abs(r.y-l.y)<h&&(loseHp(r,1),loseHp(l,1),this.score++,this.gameInfo.score(this.score),this.score>this.levelUpScore&&(this.level++,this.gameInfo.level(this.level),this.levelUpScore+=5*this.level))}}}this.hero.hp<1&&(Laya.timer.clear(this,onLoop),Laya.SoundManager.playSound("res/sound/game_over.mp3"),this.gameInfo.infoLabel.text="GameOver,分数:"+this.score+"\n点击这里重新开始",this.gameInfo.infoLabel.once(Laya.Event.CLICK,this,restart));var n=this.level<30?2*this.level:30,y=Math.floor(this.level/6),d=Math.floor(this.level/8),L=Math.floor(this.level/10);Laya.timer.currFrame%(80-n)==0&&createEnemy(0,2+L,3+y,1),Laya.timer.currFrame%(150-4*n)==0&&createEnemy(1,1+L,2+y,2+2*d),Laya.timer.currFrame%(900-4*n)==0&&(createEnemy(2,1,1+y,10+6*d),Laya.SoundManager.playSound("res/sound/enemy3_out.mp3"))}function loseHp(e,a){if(e.hp-=a,2===e.heroType&&(this.bulletLevel++,this.hero.shootType=Math.min(4,Math.floor(this.bulletLevel/2)+1),this.hero.shootInterval=500-20*(this.bulletLevel>20?20:this.bulletLevel),e.visible=!1,Laya.SoundManager.playSound("res/sound/achievement.mp3")),3===e.heroType&&(this.hero.hp=Math.min(this.hero.hp+1,10),this.gameInfo.hp(this.hero.hp),e.visible=!1),e.hp>0)e.playAction("hit");else if(e.heroType)e.visible=!1;else if("hero"!==e.type&&Laya.SoundManager.playSound("res/sound/"+e.type+"_down.mp3"),e.playAction("down"),"enemy3"===e.type){var o=Math.random()<.7?2:3,t=Laya.Pool.getItemByClass("role",Role);t.init("ufo"+(o-1),e.camp,1,1,15,o),t.pos(e.x,e.y),this.roleBox.addChild(t)}e==this.hero&&this.gameInfo.hp(e.hp)}function restart(){this.score=0,this.level=0,levelUpScore=10,this.bulletLevel=0,this.gameInfo.reset(),this.hero.init("hero",0,5,0,30),this.hero.shootType=1,this.hero.pos(240,500),this.hero.shootInterval=500,this.hero.visible=!0;for(var e=this.roleBox.numChildren-1;e>-1;e--){var a=this.roleBox.getChildAt(e);a!==this.hero&&(a.removeSelf(),a.visible=!0,Laya.Pool.recover("role",a))}resume()}function pause(){Laya.timer.clear(this,onLoop),Laya.stage.off(Laya.Event.onMouseMove,this,onMouseMove)}function resume(){Laya.timer.frameLoop(1,this,onLoop),Laya.stage.on(Laya.Event.MOUSE_MOVE,this,onMouseMove)}function onMouseMove(e){this.hero.pos(Laya.stage.mouseX,Laya.stage.mouseY)}function createEnemy(e,a,o,t){for(var s=0;s<a;s++){var r=Laya.Pool.getItemByClass("role",Role);r.init("enemy"+(e+1),1,t,o,this.radius[e]),r.pos(400*Math.random()+40,200*-Math.random()-100),this.roleBox.addChild(r)}}var self=this;this.bulletPos=[[0],[-15,15],[-30,0,30],[-45,-15,15,45]],this.level=0,this.score=0,this.levelUpScore=0,this.bulletLevel=0,this.hps=[1,2,2],this.speeds=[3,2,1],this.radius=[15,30,70],Laya.init(480,852,Laya.WebGL),Laya.stage.scaleMode=Laya.Stage.SCALE_FIXED_WIDTH,Laya.stage.alignV=Laya.Stage.ALIGN_MIDDLE,Laya.stage.alignH=Laya.Stage.ALIGN_CENTER,Laya.stage.screenMode=Laya.Stage.SCREEN_VERTICAL;var assets=[{url:"res/atlas/war.atlas",type:Laya.Loader.ATLAS},{url:"res/sound/achievement.mp3",type:Laya.Loader.SOUND},{url:"res/sound/bullet.mp3",type:Laya.Loader.SOUND},{url:"res/sound/enemy1_down.mp3",type:Laya.Loader.SOUND},{url:"res/sound/enemy2_down.mp3",type:Laya.Loader.SOUND},{url:"res/sound/enemy3_down.mp3",type:Laya.Loader.SOUND},{url:"res/sound/enemy3_out.mp3",type:Laya.Loader.SOUND},{url:"res/sound/game_over.mp3",type:Laya.Loader.SOUND}];this.progress=new ProgressInfo,Laya.stage.addChild(this.progress),Laya.loader.load("res/atlas/template/Progress.atlas",Laya.Handler.create(this,function(){Laya.loader.load(assets,Laya.Handler.create(self,onLoaded),Laya.Handler.create(self,onLoading,null,!1))}));